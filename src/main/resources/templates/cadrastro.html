<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuário</title>
</head>
<body>
    <h1>Cadastro de Usuário</h1>
    
    <form id="formUsuario">
        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
        </div>

        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>

        <div>
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone">
        </div>

        <div>
            <label for="idade">Idade:</label>
            <input type="number" id="idade" name="idade" min="1" max="120">
        </div>

        <div>
            <label for="dataNascimento">Data de Nascimento:</label>
            <input type="date" id="dataNascimento" name="dataNascimento">
        </div>

        <div>
            <label>Gênero:</label>
            <input type="radio" id="masculino" name="genero" value="Masculino" checked>
            <label for="masculino">Masculino</label>
            <input type="radio" id="feminino" name="genero" value="Feminino">
            <label for="feminino">Feminino</label>
            <input type="radio" id="outro" name="genero" value="Outro">
            <label for="outro">Outro</label>
        </div>

        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade">
        </div>

        <div>
            <label for="estado">Estado:</label>
            <select id="estado" name="estado">
                <option value="">Selecione</option>
                <option value="BA">Bahia</option>
                <option value="SP">São Paulo</option>
                <option value="RJ">Rio de Janeiro</option>
                <!-- Adicione outros estados -->
            </select>
        </div>

        <div>
            <label for="mensagem">Mensagem:</label>
            <textarea id="mensagem" name="mensagem" rows="4"></textarea>
        </div>

        <button type="submit">Cadastrar</button>
    </form>

    <hr>

    <h2>Usuários Cadastrados</h2>
    <div id="listaUsuarios"></div>

    <script>
        const API_URL = 'http://localhost:3000/api/usuarios';

        // Cadastrar usuário
        document.getElementById('formUsuario').addEventListener('submit', async (e) => {
            e.preventDefault();

            const usuario = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                idade: document.getElementById('idade').value ? parseInt(document.getElementById('idade').value) : null,
                dataNascimento: document.getElementById('dataNascimento').value || null,
                genero: document.querySelector('input[name="genero"]:checked').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                mensagem: document.getElementById('mensagem').value
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(usuario)
                });

                if (response.ok) {
                    alert('Usuário cadastrado com sucesso!');
                    document.getElementById('formUsuario').reset();
                    listarUsuarios();
                } else {
                    alert('Erro ao cadastrar usuário!');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro na requisição!');
            }
        });

        // Listar usuários
        async function listarUsuarios() {
            try {
                const response = await fetch(API_URL);
                const usuarios = await response.json();

                const lista = document.getElementById('listaUsuarios');
                lista.innerHTML = usuarios.map(u => `
                    <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                        <strong>${u.nome}</strong> - ${u.email}
                        <button onclick="deletarUsuario(${u.id})">Deletar</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        // Deletar usuário
        async function deletarUsuario(id) {
            if (!confirm('Tem certeza?')) return;

            try {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                alert('Usuário deletado!');
                listarUsuarios();
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        // Carregar lista ao abrir a página
        listarUsuarios();
    </script>
</body>
</html>